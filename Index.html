<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktiv Skak Slutspilsøvelse</title>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com?v=3.3.0"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
    <style>
        .chess-piece {
            font-family: Arial, sans-serif;
            font-size: 2rem;
            user-select: none;
        }
        .chess-square {
            width: 50px;
            height: 50px;
            transition: all 0.2s;
        }
        @media (max-width: 640px) {
            .chess-square {
                width: 40px;
                height: 40px;
            }
            .chess-piece {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    
    <script type="text/babel">
        function ChessBoard() {
            const [selectedSquare, setSelectedSquare] = React.useState(null);
            const [board, setBoard] = React.useState(Array(8).fill().map(() => Array(8).fill(null)));
            const [message, setMessage] = React.useState('Vælg en stilling for at begynde');

            const pieces = {
                whiteKing: '♔',
                blackKing: '♚',
                whiteRook: '♖',
                blackRook: '♜',
                whitePawn: '♙'
            };

            const positions = {
                opposition: {
                    pieces: {
                        'e4': { piece: 'whiteKing', color: 'white' },
                        'e6': { piece: 'blackKing', color: 'black' }
                    },
                    description: 'Opposition: Tving den sorte konge tilbage'
                },
                lucena: {
                    pieces: {
                        'e2': { piece: 'whiteKing', color: 'white' },
                        'e8': { piece: 'blackKing', color: 'black' },
                        'h1': { piece: 'whiteRook', color: 'white' },
                        'h7': { piece: 'blackRook', color: 'black' },
                        'e6': { piece: 'whitePawn', color: 'white' }
                    },
                    description: 'Lucena: Byg broen med tårnet'
                }
            };

            const setupPosition = (positionName) => {
                const newBoard = Array(8).fill().map(() => Array(8).fill(null));
                const position = positions[positionName];
                
                Object.entries(position.pieces).forEach(([square, { piece, color }]) => {
                    const [file, rank] = square.split('');
                    const x = file.charCodeAt(0) - 'a'.charCodeAt(0);
                    const y = 8 - parseInt(rank);
                    newBoard[y][x] = { piece: pieces[piece], color };
                });
                
                setBoard(newBoard);
                setMessage(position.description);
                setSelectedSquare(null);
            };

            const handleSquareClick = (row, col) => {
                if (selectedSquare) {
                    const [fromRow, fromCol] = selectedSquare;
                    const piece = board[fromRow][fromCol];
                    
                    if (piece && piece.color === 'white') {
                        const newBoard = [...board];
                        newBoard[row][col] = piece;
                        newBoard[fromRow][fromCol] = null;
                        setBoard(newBoard);
                    }
                    setSelectedSquare(null);
                } else if (board[row][col]?.color === 'white') {
                    setSelectedSquare([row, col]);
                }
            };

            return (
                <div className="max-w-2xl mx-auto p-4">
                    <h1 className="text-4xl font-bold text-center mb-4">
                        Interaktiv Skak Slutspilsøvelse
                    </h1>
                    
                    <p className="text-center mb-8">
                        Øv dig på opposition, triangulering og nøglefelter.
                    </p>
                    
                    <div className="flex gap-4 justify-center mb-4">
                        <button 
                            className="px-6 py-2 bg-white rounded-lg shadow hover:bg-gray-50"
                            onClick={() => setupPosition('lucena')}>
                            Lucena-stilling
                        </button>
                        <button 
                            className="px-6 py-2 bg-white rounded-lg shadow hover:bg-gray-50"
                            onClick={() => setupPosition('opposition')}>
                            Opposition-stilling
                        </button>
                    </div>

                    <div className="bg-white rounded-lg p-4 mb-4 text-center">
                        {message}
                    </div>

                    <div className="grid grid-cols-8 border-2 border-gray-800 mx-auto"
                         style={{ width: 'fit-content' }}>
                        {board.map((row, i) => 
                            row.map((square, j) => {
                                const isSelected = selectedSquare && 
                                    selectedSquare[0] === i && 
                                    selectedSquare[1] === j;
                                
                                return (
                                    <div 
                                        key={`${i}-${j}`}
                                        className={`
                                            chess-square flex items-center justify-center cursor-pointer
                                            ${(i + j) % 2 === 0 ? 'bg-amber-200' : 'bg-amber-800'}
                                            ${isSelected ? 'bg-green-300' : ''}
                                            ${selectedSquare ? 'hover:bg-green-200' : ''}
                                        `}
                                        onClick={() => handleSquareClick(i, j)}
                                    >
                                        <span className="chess-piece">
                                            {square?.piece}
                                        </span>
                                    </div>
                                );
                            })
                        )}
                    </div>

                    <div className="flex justify-center mt-4">
                        <button 
                            onClick={() => setupPosition('opposition')}
                            className="px-6 py-2 bg-gray-200 rounded-lg shadow hover:bg-gray-300">
                            Nulstil
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<ChessBoard />);
    </script>
</body>
</html>